# 19. ë¦¬í”Œë ‰ì…˜ (Reflection)

## í´ë˜ìŠ¤ ì •ë³´ íƒìƒ‰ (`Class`, `Field`, `Method`, `Constructor`)

### ğŸ§© 1. ê¸°ë³¸ ê°œë…: `java.lang.Class<T>`

ëª¨ë“  Java ê°ì²´ëŠ” ì‹¤í–‰ ì¤‘ì— **í´ë˜ìŠ¤ ì •ë³´(Class ê°ì²´)** ë¥¼ ê°€ì§€ê³  ìˆìŒ. ì´ ì •ë³´ëŠ” `Class<?>` íƒ€ì…ìœ¼ë¡œ í‘œí˜„ë˜ê³ , ë‹¤ì–‘í•œ ë©”ì„œë“œë¥¼ í†µí•´ **í•„ë“œ, ë©”ì„œë“œ, ìƒì„±ì, ì–´ë…¸í…Œì´ì…˜** ë“±ì„ íƒìƒ‰í•  ìˆ˜ ìˆìŒ.

```
Class<?> clazz = MyClass.class;  // ë˜ëŠ” Class.forName("com.example.MyClass")
```

------

### ğŸŸ¦ 2. í•„ë“œ(Field) íƒìƒ‰

```
Field[] fields = clazz.getDeclaredFields(); // ëª¨ë“  í•„ë“œ (private í¬í•¨)
Field publicField = clazz.getField("name"); // public í•„ë“œë§Œ
```

| ë©”ì„œë“œ                | ì„¤ëª…                                    |
| --------------------- | --------------------------------------- |
| `getFields()`         | public í•„ë“œë§Œ í¬í•¨ (ìƒì†ëœ ê²ƒë„ í¬í•¨)   |
| `getDeclaredFields()` | **ëª¨ë“  í•„ë“œ**, ìƒì† ì œì™¸ (private í¬í•¨) |

```
for (Field f : clazz.getDeclaredFields()) {
    System.out.println("í•„ë“œ ì´ë¦„: " + f.getName());
    System.out.println("íƒ€ì…: " + f.getType());
}
```

------

### ğŸŸ© 3. ë©”ì„œë“œ(Method) íƒìƒ‰

```
Method[] methods = clazz.getDeclaredMethods(); // ëª¨ë“  ë©”ì„œë“œ (private í¬í•¨)
Method m = clazz.getMethod("getName"); // public ë©”ì„œë“œë§Œ
```

| ë©”ì„œë“œ                 | ì„¤ëª…                                        |
| ---------------------- | ------------------------------------------- |
| `getMethods()`         | public ë©”ì„œë“œ + ìƒì† ë©”ì„œë“œ í¬í•¨            |
| `getDeclaredMethods()` | **ìê¸° í´ë˜ìŠ¤ì˜ ëª¨ë“  ë©”ì„œë“œ**, private í¬í•¨ |

```
for (Method m : clazz.getDeclaredMethods()) {
    System.out.println("ë©”ì„œë“œëª…: " + m.getName());
    System.out.println("ë¦¬í„´íƒ€ì…: " + m.getReturnType());
    System.out.println("íŒŒë¼ë¯¸í„° ìˆ˜: " + m.getParameterCount());
}
```

------

### ğŸŸ¥ 4. ìƒì„±ì(Constructor) íƒìƒ‰

```
Constructor<?>[] constructors = clazz.getDeclaredConstructors();
Constructor<?> defaultConstructor = clazz.getConstructor(); // public ê¸°ë³¸ ìƒì„±ì
```

| ë©”ì„œë“œ                      | ì„¤ëª…                           |
| --------------------------- | ------------------------------ |
| `getConstructors()`         | public ìƒì„±ìë§Œ                |
| `getDeclaredConstructors()` | **ëª¨ë“  ìƒì„±ì** (private í¬í•¨) |

```
for (Constructor<?> c : constructors) {
    System.out.println("ìƒì„±ì íŒŒë¼ë¯¸í„° ìˆ˜: " + c.getParameterCount());
}
```

------

### ğŸŸ¨ 5. ê¸°íƒ€ ìœ ìš©í•œ ë©”ì„œë“œ

| ë©”ì„œë“œ                  | ì„¤ëª…                                     |
| ----------------------- | ---------------------------------------- |
| `clazz.getName()`       | ì „ì²´ í´ë˜ìŠ¤ ì´ë¦„ (`com.example.MyClass`) |
| `clazz.getSimpleName()` | ë‹¨ìˆœ í´ë˜ìŠ¤ ì´ë¦„ (`MyClass`)             |
| `clazz.getSuperclass()` | ìƒì†í•œ ë¶€ëª¨ í´ë˜ìŠ¤                       |
| `clazz.getInterfaces()` | êµ¬í˜„í•œ ì¸í„°í˜ì´ìŠ¤ ë°°ì—´                   |
| `clazz.isInterface()`   | ì¸í„°í˜ì´ìŠ¤ ì—¬ë¶€                          |
| `clazz.isAnnotation()`  | ì• ë…¸í…Œì´ì…˜ ì—¬ë¶€                          |
| `clazz.isEnum()`        | ì—´ê±°í˜• ì—¬ë¶€                              |
| `clazz.isPrimitive()`   | ê¸°ë³¸í˜• ì—¬ë¶€ (int, boolean ë“±)            |

------

### ğŸ”§ 6. ë™ì  ê°ì²´ ìƒì„±

```
Object obj = clazz.getDeclaredConstructor().newInstance();
```

- private ìƒì„±ìë¼ë©´ `setAccessible(true)` í•„ìš”
- ì˜ˆì™¸ëŠ” ë°˜ë“œì‹œ try-catch ë˜ëŠ” throwsë¡œ ì²˜ë¦¬í•´ì•¼ í•¨

------

### ğŸ“Œ 7. í•„ë“œ ê°’ ì½ê¸° / ì“°ê¸°

```
Field field = clazz.getDeclaredField("name");
field.setAccessible(true); // private ì ‘ê·¼ í—ˆìš©

// ê°’ ì„¤ì •
field.set(obj, "í™ê¸¸ë™");

// ê°’ ì½ê¸°
Object value = field.get(obj);
```

------

### ğŸ§  ì˜ˆì‹œ í´ë˜ìŠ¤ ê¸°ë°˜ íƒìƒ‰

```
public class Person {
    private String name;
    private int age;

    public Person() {}
    public String getName() { return name; }
    private void print() { System.out.println(name + " - " + age); }
}
```

ìœ„ í´ë˜ìŠ¤ì— ëŒ€í•´ ì „ì²´ ë¦¬í”Œë ‰ì…˜ ì •ë³´ íƒìƒ‰í•˜ë©´:

```
Class<?> clazz = Person.class;

for (Field f : clazz.getDeclaredFields()) {
    System.out.println("í•„ë“œ: " + f.getName());
}

for (Method m : clazz.getDeclaredMethods()) {
    System.out.println("ë©”ì„œë“œ: " + m.getName());
}

for (Constructor<?> c : clazz.getDeclaredConstructors()) {
    System.out.println("ìƒì„±ì: " + c.toString());
}
```

------

### âœ… ìš”ì•½í‘œ

| ëŒ€ìƒ   | íƒìƒ‰ ë©”ì„œë“œ                                      | ì ‘ê·¼ ë²”ìœ„            |
| ------ | ------------------------------------------------ | -------------------- |
| í•„ë“œ   | `getFields()`, `getDeclaredFields()`             | public / ëª¨ë“  í•„ë“œ   |
| ë©”ì„œë“œ | `getMethods()`, `getDeclaredMethods()`           | public / ëª¨ë“  ë©”ì„œë“œ |
| ìƒì„±ì | `getConstructors()`, `getDeclaredConstructors()` | public / ëª¨ë“  ìƒì„±ì |

## ê°ì²´ ìƒì„± ë° ë©”ì„œë“œ í˜¸ì¶œ

### âœ… 1. ê°ì²´ ìƒì„± (Constructor ì´ìš©)

#### ğŸ”¹ ê¸°ë³¸ ìƒì„±ì ì‚¬ìš©

```
Class<?> clazz = MyClass.class;
Object instance = clazz.getDeclaredConstructor().newInstance();
```

- `getDeclaredConstructor()`ëŠ” **íŒŒë¼ë¯¸í„° ì—†ëŠ” ê¸°ë³¸ ìƒì„±ì**ë¥¼ ê°€ì ¸ì˜´
- ìƒì„±ìê°€ `private`ì´ë¼ë©´ `setAccessible(true)` í•„ìš”

------

#### ğŸ”¹ íŒŒë¼ë¯¸í„° ìˆëŠ” ìƒì„±ì ì‚¬ìš©

```
Constructor<?> constructor = clazz.getDeclaredConstructor(String.class, int.class);
Object instance = constructor.newInstance("í™ê¸¸ë™", 25);
```

- ìƒì„±ì ì‹œê·¸ë‹ˆì²˜ì— ë§ê²Œ íƒ€ì… ìˆœì„œ ì§€ì •
- ë‚´ë¶€ì ìœ¼ë¡œëŠ” `new MyClass("í™ê¸¸ë™", 25)` ì™€ ë™ì¼í•œ ê°ì²´ ìƒì„±

------

#### ğŸ”¹ `setAccessible(true)` ë¥¼ ì“°ëŠ” ê²½ìš°

```
Constructor<?> constructor = clazz.getDeclaredConstructor();
constructor.setAccessible(true); // private ìƒì„±ì ì ‘ê·¼ í—ˆìš©
Object obj = constructor.newInstance();
```

------

### âœ… 2. ë©”ì„œë“œ í˜¸ì¶œ (Method.invoke)

#### ğŸ”¹ ê¸°ë³¸ ì˜ˆì œ

```
Method method = clazz.getDeclaredMethod("sayHello", String.class);
method.invoke(instance, "ì² ìˆ˜");
```

- `sayHello(String name)` ê°™ì€ ë©”ì„œë“œ í˜¸ì¶œ
- ì²« ë²ˆì§¸ ì¸ìëŠ” **í˜¸ì¶œí•  ê°ì²´**
- ë‚˜ë¨¸ì§€ëŠ” **ì¸ì ë¦¬ìŠ¤íŠ¸**

------

#### ğŸ”¹ ë¦¬í„´ê°’ì´ ìˆëŠ” ê²½ìš°

```
Method method = clazz.getDeclaredMethod("add", int.class, int.class);
Object result = method.invoke(instance, 10, 20);
System.out.println("ê²°ê³¼: " + result);  // 30
```

- `Object` íƒ€ì…ìœ¼ë¡œ ë°˜í™˜ë˜ë¯€ë¡œ **í˜•ë³€í™˜** í•„ìš”í•  ìˆ˜ ìˆìŒ

------

#### ğŸ”¹ private ë©”ì„œë“œ í˜¸ì¶œ

```
Method method = clazz.getDeclaredMethod("secretMethod");
method.setAccessible(true);  // private í—ˆìš©
method.invoke(instance);
```

------

### ğŸ§ª ì˜ˆì œ ì „ì²´ ì½”ë“œ

```
public class Person {
    private String name;

    public Person(String name) {
        this.name = name;
    }

    public void greet(String target) {
        System.out.println(name + " says hello to " + target);
    }

    private void secret() {
        System.out.println("This is a secret.");
    }
}
```

```
Class<?> clazz = Person.class;

// ìƒì„±ì í˜¸ì¶œ
Constructor<?> constructor = clazz.getDeclaredConstructor(String.class);
Object person = constructor.newInstance("ì² ìˆ˜");

// public ë©”ì„œë“œ í˜¸ì¶œ
Method greet = clazz.getDeclaredMethod("greet", String.class);
greet.invoke(person, "ì˜í¬");

// private ë©”ì„œë“œ í˜¸ì¶œ
Method secret = clazz.getDeclaredMethod("secret");
secret.setAccessible(true);
secret.invoke(person);
```

------

### ğŸ§  ì£¼ì˜ì‚¬í•­

| í•­ëª©        | ì£¼ì˜í•  ì                                                     |
| ----------- | ------------------------------------------------------------ |
| ì˜ˆì™¸ ì²˜ë¦¬   | `InvocationTargetException`, `IllegalAccessException`, `NoSuchMethodException` ë“± ì˜ˆì™¸ ë°œìƒ ê°€ëŠ¥ |
| ì ‘ê·¼ ì œì–´   | `private` ì ‘ê·¼ ì‹œ ë°˜ë“œì‹œ `setAccessible(true)` í•„ìš”          |
| ì„±ëŠ¥        | ì¼ë°˜ ë©”ì„œë“œ í˜¸ì¶œë³´ë‹¤ **ëŠë¦¼**, ë¹ˆë²ˆí•œ í˜¸ì¶œì€ ì§€ì–‘            |
| íƒ€ì… ìºìŠ¤íŒ… | `invoke()` ë°˜í™˜ê°’ì€ `Object` â†’ í•„ìš”í•œ ê²½ìš° ëª…ì‹œì  ìºìŠ¤íŒ… í•„ìš” |

------

### ğŸ“Œ ë©”ì„œë“œì™€ ìƒì„±ì ê´€ë ¨ ì£¼ìš” ë©”ì„œë“œ

| ë¦¬í”Œë ‰ì…˜ ë©”ì„œë“œ                | ì˜ë¯¸                                 |
| ------------------------------ | ------------------------------------ |
| `getDeclaredConstructor(...)`  | íŠ¹ì • íŒŒë¼ë¯¸í„° ì‹œê·¸ë‹ˆì²˜ì˜ ìƒì„±ì íƒìƒ‰ |
| `newInstance(...)`             | ë™ì  ê°ì²´ ìƒì„±                       |
| `getDeclaredMethod(name, ...)` | ì´ë¦„ê³¼ íŒŒë¼ë¯¸í„° íƒ€ì…ìœ¼ë¡œ ë©”ì„œë“œ íƒìƒ‰ |
| `invoke(object, ...)`          | ë©”ì„œë“œ ì‹¤í–‰                          |
| `setAccessible(true)`          | ì ‘ê·¼ ì œì–´ ë¬´ì‹œ (private í¬í•¨)        |

------

### ğŸ”’ ë¦¬í”Œë ‰ì…˜ ë³´ì•ˆ ì •ì±…

- Java 9 ì´ìƒì—ì„œëŠ” **ëª¨ë“ˆ ì‹œìŠ¤í…œ + ë³´ì•ˆ ë§¤ë‹ˆì €**ë¡œ ì¸í•´ `setAccessible(true)` ì‚¬ìš©ì´ ì œí•œë  ìˆ˜ ìˆìŒ.
- `--add-opens` JVM ì˜µì…˜ì„ ì¶”ê°€í•´ ì˜ˆì™¸ íšŒí”¼ ê°€ëŠ¥.

```
--add-opens java.base/java.lang=ALL-UNNAMED
```

------

### âœ¨ ì •ë¦¬

- ê°ì²´ ìƒì„±: `Constructor.newInstance(...)`
- ë©”ì„œë“œ í˜¸ì¶œ: `Method.invoke(...)`
- private ì ‘ê·¼ í—ˆìš©: `setAccessible(true)`
- ë¦¬í„´ê°’ì€ í•­ìƒ `Object` â†’ íƒ€ì…ì— ë”°ë¼ ìºìŠ¤íŒ… í•„ìš”

## private ë©¤ë²„ ì ‘ê·¼

### âœ… 1. `Field`ë¥¼ í†µí•œ `private` í•„ë“œ ì ‘ê·¼

#### ğŸ”¹ í´ë˜ìŠ¤ ì •ì˜ ì˜ˆì‹œ

```
public class Person {
    private String name = "ë¹„ê³µê°œ";
}
```

#### ğŸ”¹ ë¦¬í”Œë ‰ì…˜ìœ¼ë¡œ í•„ë“œ ê°’ ì½ê¸°/ì“°ê¸°

```
Class<?> clazz = Person.class;
Object instance = clazz.getDeclaredConstructor().newInstance();

// private í•„ë“œ ê°€ì ¸ì˜¤ê¸°
Field field = clazz.getDeclaredField("name");
field.setAccessible(true); // ì ‘ê·¼ ì œì–´ í•´ì œ

// í•„ë“œ ê°’ ì½ê¸°
String value = (String) field.get(instance);
System.out.println("name í•„ë“œ ê°’: " + value); // ë¹„ê³µê°œ

// í•„ë“œ ê°’ ë³€ê²½
field.set(instance, "í™ê¸¸ë™");
System.out.println("ë³€ê²½ëœ ê°’: " + field.get(instance)); // í™ê¸¸ë™
```

------

### âœ… 2. `Method`ë¥¼ í†µí•œ `private` ë©”ì„œë“œ ì ‘ê·¼

```
public class SecretBox {
    private String revealSecret() {
        return "ë¹„ë°€ ë©”ì‹œì§€";
    }
}
```

```
Class<?> clazz = SecretBox.class;
Object box = clazz.getDeclaredConstructor().newInstance();

Method method = clazz.getDeclaredMethod("revealSecret");
method.setAccessible(true); // private ë©”ì„œë“œ ì ‘ê·¼ í—ˆìš©

Object result = method.invoke(box);
System.out.println("ë©”ì„œë“œ ì‹¤í–‰ ê²°ê³¼: " + result); // ë¹„ë°€ ë©”ì‹œì§€
```

------

### âœ… 3. `Constructor`ë¥¼ í†µí•œ `private` ìƒì„±ì í˜¸ì¶œ

```
public class Singleton {
    private Singleton() {
        System.out.println("ë¹„ê³µê°œ ìƒì„±ì í˜¸ì¶œë¨");
    }
}
```

```
Class<?> clazz = Singleton.class;
Constructor<?> constructor = clazz.getDeclaredConstructor();
constructor.setAccessible(true); // private ìƒì„±ì ì ‘ê·¼ í—ˆìš©

Object instance = constructor.newInstance(); // ì •ìƒì ìœ¼ë¡œ ìƒì„±ë¨
```

------

### âš ï¸ ë³´ì•ˆê³¼ ê¶Œí•œ

Java 9 ì´ìƒë¶€í„°ëŠ” ëª¨ë“ˆ ì‹œìŠ¤í…œ(JPMS)ìœ¼ë¡œ ì¸í•´
 `setAccessible(true)` í˜¸ì¶œ ì‹œ **ê¶Œí•œ ì˜¤ë¥˜** ë˜ëŠ” **InaccessibleObjectException**ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

#### í•´ê²° ë°©ë²• (JVM ì˜µì…˜ ì¶”ê°€)

```
--add-opens java.base/java.lang=ALL-UNNAMED
```

------

### ğŸ§  ìš”ì•½í‘œ

| ëŒ€ìƒ      | ë©”ì„œë“œ                       | ì„¤ëª…                      |
| --------- | ---------------------------- | ------------------------- |
| í•„ë“œ      | `Field.get()`, `Field.set()` | private í•„ë“œ ì ‘ê·¼ ë° ì¡°ì‘ |
| ë©”ì„œë“œ    | `Method.invoke()`            | private ë©”ì„œë“œ ì‹¤í–‰       |
| ìƒì„±ì    | `Constructor.newInstance()`  | private ìƒì„±ì í˜¸ì¶œ       |
| ì ‘ê·¼ í•´ì œ | `setAccessible(true)`        | ì ‘ê·¼ ì œí•œ í•´ì œ í•„ìˆ˜       |

------

### ğŸ“Œ ì£¼ì˜ì‚¬í•­

- ë³´ì•ˆ ë§¤ë‹ˆì €ê°€ í™œì„±í™”ëœ í™˜ê²½ì—ì„œëŠ” `setAccessible(true)`ê°€ ì œí•œë  ìˆ˜ ìˆìŒ.
- ë¦¬í”Œë ‰ì…˜ì€ ê°•ë ¥í•˜ì§€ë§Œ **ì„±ëŠ¥ ì €í•˜**, **ìº¡ìŠí™” ì¹¨í•´**, **ìœ ì§€ë³´ìˆ˜ì„± ì €í•˜**ë¼ëŠ” ë‹¨ì ë„ ìˆìŒ.
- **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸, DI, ORM ë‚´ë¶€ êµ¬í˜„ ë“±ì—ì„œ ì œí•œì ìœ¼ë¡œ ì‚¬ìš©**í•´ì•¼ í•œë‹¤.